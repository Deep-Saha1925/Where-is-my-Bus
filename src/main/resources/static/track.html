<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Title</title>-->
<!--</head>-->
<!--<body>-->
<!--  <script>-->
<!--      const rideId = new URLSearchParams(window.location.search).get("rideId");-->

<!--        async function loadBus() {-->
<!--          const res = await fetch(`/api/ride/${rideId}/location/latest`);-->
<!--          const loc = await res.json();-->

<!--          marker.setLatLng([loc.latitude, loc.longitude]);-->
<!--          map.setView([loc.latitude, loc.longitude], 16);-->
<!--        }-->

<!--        setInterval(loadBus, 3000);-->

<!--  </script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html>
<head>
    <title>Track Bus</title>
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>#map{height:100vh}
        .bus-marker i {
          font-size: 26px;
          color: #1976d2;
        }
    </style>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
    const rideId = params.get("rideId");

    const map = L.map("map").setView([26.7271, 88.3953], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
      .addTo(map);

   const busIcon = L.divIcon({
      html: `<i class="fa-solid fa-bus"></i>`,
      className: "bus-marker",
      iconSize: [30, 30],
      iconAnchor: [15, 15],
    });

    let marker;

    async function updateLocation() {
      const res = await fetch(
        `http://localhost:8080/api/location/last-loc/${rideId}`
      );

      if (!res.ok) return;

      const loc = await res.json();
      if (!loc) return;

      const pos = [loc.latitude, loc.longitude];

      if (!marker) {
        marker = L.marker(pos, {icon: busIcon}).addTo(map);
      } else {
        marker.setLatLng(pos);
      }

      map.setView(pos);
    }

    updateLocation();
    setInterval(updateLocation, 3000);
</script>

</body>
</html>
